# 第八章    异常控制流

## 学习目标：

- **进程的基本概念**
- **进程是如何工作的？**
- **在应用程序中创建和操纵进程**
- **如何通过 Linux 系统调用来使用多个进程**
- **初步了解并发执行的不确定的行为**

## 8.1    异常

**本节概要：**

- **首先，介绍应用程序发送异常指令后，处理器会进行 异常处理 ，处理完成后会根据引起   异常事件的类型，返回的三种操作。**
- **紧接着阐述，从软件和硬件的双角度出发，处理器是介绍异常处理的过程**
- **随后，小结了异常事件的类型大体上被分为4种，每一种都用图文说明了 处理的过程 以及对应的 返回操作**

- **最后，以 Linux 操作系统举例，示例了 Linux 中的异常类型，简单展示了 Linux 系统调用（系统级函数）**

### 8.1.1    异常处理

- **异常号：（软硬件分工）**
  - **硬件：**其中一些号码是由 处理器的设计者分配
    - 这里包括被 除零、缺页、内存方位违例、断点以及算数运算溢出
  - **软件：**其他号码是由操作系统内核（操作系统常驻内存的部分）的设计者分配的。
    - 这里包括 系统调用 和 来自外部 I/O 设备的信号

- **处理逻辑**
  1. 系统启动时（上电），操作系统分配和初始化一张跳转表（异常表）
  2. 运行时（执行某个程序时），处理器检测（电压异常啥的）到发生了一个事件，并且确定了相应的异常号
  3. 随后，处理器出发异常——通过异常表的标目，转到相应的处理程序

- **异常有点向过程调用，重要不同之处如下：**
  - 过程调用，在跳转到处理程序之前，处理器将返回地址压入栈中。
    - 但是，根据异常类型，返回地址要么时当前指令，要么是下一条指令
  - 处理器也会把一些额外的状态压到栈中，在处理程序返回时，重新开始执行被中断的程序会需要这些状态
  - 如果控制从用户程序转移到内核，所有这些项目都不会被压到内核的栈中，而不是用户栈中
  - 异常处理程序运行在内核模式下，这意味着所有的系统资源都有完全的访问权

### 8.1.2    异常的类别

*同步异常 是 执行一套指令的直接产物*

- #### 中断 —— 异步，总是返回到下一条指令

  - 中断是异步发生的，是来自处理器外部 I/O设备的信号结果

- #### 陷阱和系统调用 —— 同步，总是返回到下一条指令

  - 陷阱是 **有意的异常**
  - 陷阱最重要的用途是在用户程序和内核之间提供一个像过程一样的接口，叫做**系统调用**

- #### 故障 —— 同步，可能返回到当前指令

  - 故障由 错误情况引起，它可能能够被故障处理程序修正
  - 可以通过阅读书中例子，更加清楚故障的执行过程

- #### 终止 —— 同步，不会返回

  - 不可恢复的致命错误造成的结果

### 8.1.3   Linux/x86-64 系统中的异常

- #### Linux/x86-64 故障和终止

- #### Linux/86-64 系统调用

## 8.2    进程

